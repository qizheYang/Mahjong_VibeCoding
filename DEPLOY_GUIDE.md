# Mahjong — Deploy Guide for Claude Code

## Project Overview

**App:** Riichi Mahjong (Japanese mahjong against AI opponents)
**Framework:** Flutter (Dart)
**Live URL:** https://rehydratedwater.com/mahjong/
**GitHub Repo:** `qizheYang/Mahjong_VibeCoding` (private)
**Hosting Repo:** `qizheYang/rehydratedwater.com`

---

## How Deployment Works

This project uses **automated deployment via GitHub Actions**. The pipeline is:

1. You push to `main` on this repo
2. GitHub Actions builds the Flutter web app with `--base-href "/mahjong/"`
3. The workflow checks out `qizheYang/rehydratedwater.com`, copies the build output into `mahjong/`, and pushes
4. A webhook on the server auto-pulls the change — the site is live within seconds

**You do NOT need to manually build or copy files.** Just push to `main` and the pipeline handles everything.

---

## Development Workflow

### Making changes

1. Edit source code in `lib/`
2. Test locally: `flutter run -d chrome`
3. Commit and push to `main`:

```bash
git add .
git commit -m "Description of changes"
git push origin main
```

4. The GitHub Actions workflow will build and deploy automatically

### Checking deploy status

```bash
gh run list --repo qizheYang/Mahjong_VibeCoding --limit 1
```

If a run fails:

```bash
gh run view <run-id> --repo qizheYang/Mahjong_VibeCoding --log-failed
```

---

## Project Structure

```
mahjong/
├── lib/
│   ├── main.dart                  ← App entry point
│   ├── app.dart                   ← Root widget
│   ├── engine/                    ← Pure Dart game engine
│   │   ├── ai/                    ← AI player logic
│   │   ├── game/                  ← Game controller, turn manager, round flow
│   │   ├── scoring/               ← Han, fu, payment calculation
│   │   ├── state/                 ← Game state, player state, actions, events
│   │   ├── tile/                  ← Tile types and constants
│   │   ├── win/                   ← Win detection, tenpai, furiten, shanten
│   │   └── yaku/                  ← Yaku evaluation and checks
│   ├── providers/                 ← Riverpod state management
│   ├── ui/                        ← Flutter UI widgets
│   │   ├── dialogs/               ← Game over, round result dialogs
│   │   ├── hud/                   ← Action bar, call prompt, score display
│   │   ├── screens/               ← Title, game, game over screens
│   │   ├── table/                 ← Table view, hand, discards, melds
│   │   ├── theme/                 ← Colors and theming
│   │   └── tiles/                 ← Tile rendering widgets
│   └── utils/                     ← Extensions and helpers
├── web/                           ← Web platform files (favicon, icons, manifest)
├── build/web/                     ← Built output (auto-generated, do not edit)
├── .github/workflows/deploy.yml   ← Auto-deploy workflow
├── pubspec.yaml                   ← Dependencies
└── DEPLOY_GUIDE.md                ← This file
```

---

## Key Dependencies

- **flutter_riverpod** `^2.6.1` — State management
- **collection** `^1.19.1` — Collection utilities

---

## Important Notes

- **Do NOT edit `build/web/`** — it is auto-generated by the build process and will be overwritten.
- **Base href:** The workflow builds with `--base-href "/mahjong/"`. This is required because the app is served at a subpath, not the domain root.
- **GitHub Actions secret:** The workflow uses the `REHYDRATEDWATERCOM` secret (a GitHub PAT with `repo` scope) to push to the hosting repo. If it expires, generate a new one at https://github.com/settings/tokens and update it:
  ```bash
  gh secret set REHYDRATEDWATERCOM --repo qizheYang/Mahjong_VibeCoding
  ```
- **Landing page:** The app is listed on the rehydratedwater.com landing page (`index.html` in the hosting repo). If you rename or remove the app, update the landing page too.
- **Server:** DigitalOcean droplet at `143.198.106.233`. Nginx serves static files from `/var/www/rehydratedwater.com/`. No build step on the server.
